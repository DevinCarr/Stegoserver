/*!
 * Stegoserver 2014-07-10
 * Copyright (c) 2014 Devin Carr; Licensed MIT 
*/
var stego_server={start:function(a,b,c){this.s_console=c,http.createServer(function(a,d){c.log("info","request",a.url),"/"===a.url?(d.writeHead(200,{"Content-Type":"text/html"}),fs.readFile(b+"./index.html",function(b,c){b?returnFour(stego_console,a,b):(d.write(c),d.end())})):-1!==a.url.indexOf("html")?(d.writeHead(200,{"Content-Type":"text/html"}),fs.readFile(b+"./"+a.url,function(b,c){b?returnFour(stego_console,a,b):(d.write(c),d.end())})):-1!==a.url.indexOf("/",a.url.length-1)?(d.writeHead(200,{"Content-Type":"text/html"}),fs.readFile(b+"."+a.url+"/index.html",function(b,c){b?returnFour(stego_console,a,b):(d.write(c),d.end())})):(d.writeHead(200,{"Content-Type":"text/plain"}),fs.readFile(b+"."+a.url,function(b,c){b?returnFour(stego_console,a,b):(d.write(c),d.end())}))}).listen(a)},returnFour:function(a,b){s_console.log("error","request",b),a.write("Error: 404"),a.end()},s_console:""},stego_console={log:function(a,b,c){var d=buildLog(a,b,c);fileName?writeLog(d):outLog(d)},start:function(a){fileName=a},writeLog:function(a){fs.appendFile(fileName,a,function(a){if(a)throw a})},outLog:function(a){console.log(a)},buildLog:function(a,b,c){a=a||"[INFO]";var d=new Date,e=d.toUTCString()+" ";return e+="["+a.toUpperCase()+"] ",""!==b&&(e+="["+b.toUpperCase()+"] "),e+=": "+c},fileName:""},fs=require("fs"),http=require("http"),main=function(){var a=stego_server,b=stego_console;args=checkArgs(),port=args.port,log=args.log,path=args.path,b.start(log),a.start(port,path,b);new Date;b.log("info","initialization","Stegoserver starting on port:"+port)},checkArgs=function(){var a=process.argv.slice(2),b=8080,c="",d="./app/";return a.forEach(function(e,f){if("-h"===e||"--help"===e)console.log("Usage: Stegoserver.js [options]\n\nA simple static Nodejs webserver\n\nOptions:\n  -p, --port [PORT]	The port number to bind the webservice to. Default: 8080\n  -l, --location [FILE_PATH]	The location of the app to serve files from (app folder). Default .\n  -d, --debug [FILE_NAME]	The name of the log file. Default: Console"),process.exit(0);else if("-p"===e)"number"==typeof+a[f+1]&&(b=a[f+1]);else if("-d"===e){var g=a[f+1];"string"==typeof g&&(c=-1!==g.indexOf(".log")?g+".log":g)}else if("-l"===e){var h=a[f+1];"string"==typeof h&&fs.openSync(h,"r",function(a){a?(console.log("ERROR: "+a),process.exit(0)):d=h})}}),{port:b,log:c,path:d}};require.main===module&&main();